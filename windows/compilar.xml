<?xml version="1.0" encoding="UTF-8"?>
<project name="Instalador" default="compilar" basedir=".">
    <description>Compila o instalador do Portugol-Studio</description>
	<property environment="env"/>
	
	<target name="compilar" description="Distribuição" depends="criar-diretorios,compilar-launch4j,compilar-portugol,compilar-instalador">
        <delete dir="temp"/>
		<delete dir="../arquivos/bin"/>
    </target>
	
	<target name="criar-diretorios">
		<delete dir="dist"/>
		<mkdir dir="temp"/>
		<mkdir dir="dist"/>
		<mkdir dir="../arquivos/bin"/>
    </target>
	
	<target name="compilar-launch4j">
		<exec dir="${env.LAUNCH4J_HOME}" executable="launch4jc">
			<arg value="${basedir}/inicializador-console.xml"/>
		</exec>
		<exec dir="${env.LAUNCH4J_HOME}" executable="launch4jc">
			<arg value="${basedir}/inicializador-studio.xml"/>
		</exec>
	</target>
	
	<target name="compilar-portugol">
		<!--
			<ant dir="../../Portugol-Studio" antfile="build.xml" target="distribuicao"/>
			
			Não funciona, portanto vamos utilizar o cmd para invocar o ant e compilar o Portugol
		-->
		<exec dir="${basedir}" executable="cmd">
			<arg value="/c"/>
			<arg value="ant.bat"/>
			<arg value="-buildfile"/>
			<arg value="../../Portugol-Studio/build.xml"/>
			<arg value="distribuicao"/>
		</exec>
	</target>
	
	<target name="compilar-instalador">
		<exec executable="ISCC">
			<arg value="instalador.iss"/>
		</exec>
	</target>
	
</project>
